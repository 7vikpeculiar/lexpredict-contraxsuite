# Generated by Django 2.2.8 on 2020-01-10 13:54

from django.db import migrations, connection


def categorize_old_values(apps, schema_editor):
    cat_keys = {
        'Common': ['track_api', 'track_api_greater_than', 'track_api_save_sql_log',
                   'enable_auth_token_in_query_string', 'custom_links_header',
                   'custom_logo_url'],
        'Deployment': ['deployment_terms_initialized', 'deployment_courts_initialized',
                       'deployment_geoentities_initialized', 'deployment_document_data_initialized'],
        'Document': ['admin_running_tasks_validation_enabled', 'tika_remote_server_endpoint',
                     'tika_timeout', 'tika_parse_mode',
                     'max_document_size', 'max_archive_size',
                     'preprocess_doctext_linebreaks', 'preprocess_doctext_punct',
                     'locate_text_unit_tags', 'locate_text_unit_properties',
                     'ocr_enable', 'ocr_file_size_limit',
                     'msword_to_text_enable', 'force_rewrite_doc',
                     'strict_parse_dates', 'detect_contract'],
        'Extract': ['standard_locators', 'optional_locators'],
        'Notifications': ['disable_event_notifications'],
        'RawDB': ['rawdb_doc_grid_caching_disabled'],
        'Task': ['remove_ready_tasks_delay_in_hours']
    }

    sql_cmd = ''
    for category in cat_keys:
        keys_str = ','.join([f"'{k}'" for k in cat_keys[category]])
        sql_cmd += f"UPDATE common_appvar SET category='{category}' where name in ({keys_str});\n"

    with connection.cursor() as cursor:
        cursor.execute(sql_cmd)


class Migration(migrations.Migration):

    dependencies = [
        ('common', '0025_auto_20200110_1354'),
    ]

    operations = [
        migrations.RunPython(categorize_old_values, reverse_code=migrations.RunPython.noop),
    ]
