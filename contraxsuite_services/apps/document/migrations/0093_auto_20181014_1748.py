# -*- coding: utf-8 -*-
# Generated by Django 1.11.3 on 2018-10-14 17:48
from __future__ import unicode_literals

from django.db import migrations, models


def _migrate(apps, schema_editor):
    DocumentTypeField = apps.get_model('document', 'DocumentTypeField')
    for dtf in DocumentTypeField.objects.all():  # type: DocumentTypeField
        no_ml = bool(dtf.use_regexp_always)
        f = dtf.document_field  # type: DocumentField
        if f.formula:
            f.value_detection_strategy = 'use_formula_only' if no_ml else 'formula_and_fields_based_ml'
        elif f.python_coded_field:
            f.value_detection_strategy = 'python_coded_field'
        else:
            f.value_detection_strategy = 'use_regexps_only' if no_ml else 'regexps_and_text_based_ml'
        f.save()


class Migration(migrations.Migration):
    dependencies = [
        ('document', '0092_auto_20181012_2155'),
    ]

    operations = [
        migrations.AlterField(
            model_name='documenttypefield',
            name='use_regexp_always',
            field=models.BooleanField(default=False),
        ),
        migrations.RunPython(_migrate, reverse_code=migrations.RunPython.noop),
        migrations.RemoveField(
            model_name='documenttypefield',
            name='use_regexp_always',
        )
    ]
