# -*- coding: utf-8 -*-
# Generated by Django 1.11.3 on 2018-07-25 14:17
from __future__ import unicode_literals

from django.db import migrations


def migrate_data(apps, schema_editor):
    Task = apps.get_model('task', 'Task')
    UploadSession = apps.get_model('project', 'UploadSession')
    Project = apps.get_model('project', 'Project')
    for task in Task.objects.exclude(
            metadata__project_id__isnull=True,
            metadata__session_id__isnull=True):
        if task.metadata.get('project_id'):
            task.project = Project.objects.get(pk=task.metadata['project_id'])
        if task.metadata.get('session_id'):
            task.upload_session = UploadSession.objects.get(pk=task.metadata['session_id'])
        task.save()


class Migration(migrations.Migration):

    dependencies = [
        ('task', '0031_auto_20180725_1416'),
    ]

    operations = [
        migrations.RunPython(migrate_data),
    ]
